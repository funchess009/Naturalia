<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bloons contre naturalia</title>
    <link rel="stylesheet" href="styling/style.css" />
  </head>
  <body>
    <div id="mainContainer">
      <img id="bloonsMap" src="images/Monkeys/Asset 4.png" alt="" />
      <div id="bloonsBaseContainer">
        <img id="bloonsBase" src="images/logo_green.png" alt="" />
      </div>
      <div id="monkeyPurchasesContainer">
        <div class="monkeyPurchase">
          <img src="images/Monkeys/Asset 1.png" alt="" />
        </div>
        <div class="monkeyPurchase">
          <img src="images/Monkeys/Asset 2.png" alt="" />
        </div>
        <div class="monkeyPurchase">
          <img src="images/Monkeys/Asset 3.png" alt="" />
        </div>
      </div>
    </div>

    <script>
      const mainContainer = document.getElementById("mainContainer");
      setUpPlacementSquares();
      let bloonsPerSecond = 1000;
      let death = false;
      let baseState = 0;
      let squares = document.querySelectorAll(".placementSquare");
      let targetSquare;

      function setUpPlacementSquares() {
        for (let i = 0; i < 7; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = i * 11.6 + "vw"; // Set the left position
        }
        for (let i = 0; i < 6; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = 81 + "vw"; // Set the left position
          square.style.top = i * 17 + "vh";
        }
        for (let i = 1; i < 6; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = 71 + "vw"; // Set the left position
          square.style.top = i * 17 + "vh";
        }
        for (let i = 0; i < 3; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = i * 9 + "vw"; // Set the left position
          square.style.top = 23 + "vh";
        }
        for (let i = 2; i < 5; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = 0 + "vw"; // Set the left position
          square.style.top = i * 18 + 12 + "vh";
        }
        for (let i = 1; i < 4; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = i * 16 + "vh"; // Set the left position
          square.style.top = 85 + "vh";
        }
        for (let i = 4; i < 7; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = i * 16 + 8.4 + "vh"; // Set the left position
          square.style.top = 85 + "vh";
        }
        for (let i = 4; i < 6; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = i * 18 + 10.4 + "vh"; // Set the left position
          square.style.top = 15 + "vh";
        }
        for (let i = 0; i < 1; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = 29.3 + "vh"; // Set the left position
          square.style.top = 62 + "vh";
        }
        for (let i = 0; i < 1; i++) {
          let square = document.createElement("div");
          square.className = "placementSquare";
          mainContainer.appendChild(square); // Add the square to the container
          square.style.left = 57 + "vh"; // Set the left position
          square.style.top = 23.5 + "vh";
        }
      }

      console.log("squares:" + squares);
      squares.forEach((square) => {
        square.addEventListener("click", (event) => {
          targetSquare = square;
        });
      });

      updateState();
      function updateState() {
        let bloonsBaseContainer = document.getElementById(
          "bloonsBaseContainer"
        );
        if (baseState == 0) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV1.png" alt="" />;';
        } else if (baseState == 1) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV2.png" alt="" />;';
        } else if (baseState == 2) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV3.png" alt="" />;';
        } else if (baseState == 3) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV4.png" alt="" />;';
        } else if (baseState == 4) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV5.png" alt="" />;';
        } else if (baseState == 5) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV6.png" alt="" />;';
        } else if (baseState == 6) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV7.png" alt="" />;';
        } else if (baseState == 7) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV8.png" alt="" />;';
        } else if (baseState == 8) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV9.png" alt="" />;';
        } else if (baseState == 9) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" /><img id="bubbleArmour" src="images/bubbles/BubbleV10.png" alt="" />;';
        } else if (baseState == 10) {
          bloonsBaseContainer.innerHTML =
            '<img id="bloonsBase" src="images/logo_green.png" alt="" />;';
        } else if (baseState == 11) {
          bloonsBaseContainer.innerHTML = "";
          death = true;
          mainContainer.innerHTML +=
            '<div id="DeathMessage"><h1>Tu es mort</h1><h3><a href="bloonsVnaturalia.html">Rejouer?</a></h3></div>';
          let monkeyPurchasesContainer = document.getElementById(
            "monkeyPurchasesContainer"
          );
          monkeyPurchasesContainer.innerHTML = "";
        }
      }

      class Bloon {
        constructor(mainContainer) {
          this.animationStage = 0;
          this.mainContainer = mainContainer;
          this.bloons = []; // Array to store references to bloon instances
          this.createBloon();
          this.animation = setInterval(() => this.moveBloon(), 20);
        }

        createBloon() {
          let red = 255;
          let green = 0;
          let blue = 0;
          const bloonContainer = document.createElement("div");
          bloonContainer.className = "bloonContainer";
          bloonContainer.innerHTML =
            '<div class="bloonBody"><div class="bloonTip" style="backgroundColor: rgb(' +
            red +
            "," +
            green +
            "," +
            blue +
            ")></div></div>";
          this.mainContainer.appendChild(bloonContainer);
          const bloon = {
            link: bloonContainer,
            left: 0,
            top: 36,
            lives: 5,
          };

          bloon.link.style.backgroundColor =
            "rgb(" + red + "," + green + "," + blue + ")";
          this.bloons.push(bloon); // Add bloon to the array
        }

        moveBloon() {
          this.bloons.forEach((bloon) => {
            if (this.animationStage < 147) {
              bloon.left += 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 192) {
              bloon.top -= 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 243) {
              bloon.left -= 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 365) {
              bloon.top += 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 417) {
              bloon.left -= 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 464) {
              bloon.top -= 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 608) {
              bloon.left += 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 658) {
              bloon.top -= 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 697) {
              bloon.left += 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 780) {
              bloon.top += 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 874) {
              bloon.left -= 0.5;
              this.animationStage += 1;
            } else if (this.animationStage < 950) {
              bloon.top += 0.5;
              this.animationStage += 1;
            }

            this.updateLocation(bloon.link, bloon.left, bloon.top);
          });

          if (this.animationStage >= 880) {
            baseState += 1;
            this.bloons.forEach((bloon) => {
              bloon.link.style.display = "none"; // Hide the blood element
            });
            updateState();
            clearInterval(this.animation); // Stop the animation when it reaches the desired position
          }
        }

        updateLocation(link, left, top) {
          link.style.left = left + "vh";
          link.style.top = top + "vh";
        }

        // Method to access information of all bloons
        getAllBloonsInfo() {
          return this.bloons.map((bloon) => ({
            link: bloon.link,
            left: bloon.left,
            top: bloon.top,
            lives: bloon.lives,
          }));
        }
      }

      function startBloonGeneration() {
        setInterval(() => {
          if (death == false) {
            console.log(death);
            new Bloon(mainContainer);
            bloonsPerSecond -= 10;
          }
        }, bloonsPerSecond);
      }
      startBloonGeneration();
      const bloonInstance = new Bloon(mainContainer);

      const allBloonsInfo = bloonInstance.getAllBloonsInfo();
    </script>
  </body>
</html>
