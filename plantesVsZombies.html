<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plantes contre Zombies</title>
    <link rel="stylesheet" href="styling/style.css" />
    <link rel="icon" href="images/logo_green.png" type="image/png" />
  </head>
  <body>
    <header>
      <div id="left">
        <a href="index.html">
          <!-- Provide a valid URL -->
          <img src="images/logo_green.png" alt="Logo" id="logo" />
        </a>
        <h2 id="Header-Name">Naturalia</h2>
      </div>
      <div id="middle">
        <button class="current"><a href="index.html">Acceuil</a></button>
        <button>
          <a href="signets.html">Signets</a>
        </button>
        <button>
          <a href="parcourir.html">Parcourir</a>
        </button>
        <button>
          <a href="créer.html">Créer</a>
        </button>
        <button>
          <a href="plus.html">Plus</a>
        </button>
      </div>
      <div id="right">
        <a href="search.html">
          <img src="images/search.png" alt="" id="search" />
        </a>
        <a href="login.html">
          <img src="images/user.png" alt="" id="user" />
        </a>
      </div>
    </header>
    <div id="zomMain">
      <div id="purchase">
        <div id="sunflower">
          <img id="sunflowerImg" src="images/Sunflower2009HD.webp" alt="" />
          <h3>10</h3>
        </div>

        <div id="peashooter">
          <img
            id="peashooterImg"
            src="images/1769829-plant_peashooter_thumb.webp"
            alt=""
          />
          <h3>20</h3>
        </div>
        <div id="snowpea">
          <img id="snowpeaImg" src="images/HDplus_snowpea.webp" alt="" />
          <h3>35</h3>
        </div>
        <div id="Money">
          <img src="images/SunPlantVZom.webp" alt="Sun image" />
          <h1 id="moneyDisplay">100</h1>
        </div>
      </div>
      <div id="terrain">
        <div id="lawnMowers">
          <img src="images/Lawn_Mower.webp" alt="" />
          <img src="images/Lawn_Mower.webp" alt="" />
          <img src="images/Lawn_Mower.webp" alt="" />
          <img src="images/Lawn_Mower.webp" alt="" />
          <img src="images/Lawn_Mower.webp" alt="" />
        </div>
        <div id="plantContainer"></div>
        <div id="projectileContainer"></div>
        <div id="grass">
          <div class="zomGrass" id="grass1"></div>
          <div class="zomGrass" id="grass2"></div>
          <div class="zomGrass" id="grass3"></div>
          <div class="zomGrass" id="grass4"></div>
          <div class="zomGrass" id="grass5"></div>
          <div class="zomGrass" id="grass6"></div>
          <div class="zomGrass" id="grass7"></div>
          <div class="zomGrass" id="grass8"></div>
          <div class="zomGrass" id="grass9"></div>
          <div class="zomGrass" id="grass10"></div>
          <div class="zomGrass" id="grass11"></div>
          <div class="zomGrass" id="grass12"></div>
          <div class="zomGrass" id="grass13"></div>
          <div class="zomGrass" id="grass14"></div>
          <div class="zomGrass" id="grass15"></div>
          <div class="zomGrass" id="grass16"></div>
          <div class="zomGrass" id="grass17"></div>
          <div class="zomGrass" id="grass18"></div>
          <div class="zomGrass" id="grass19"></div>
          <div class="zomGrass" id="grass20"></div>
          <div class="zomGrass" id="grass21"></div>
          <div class="zomGrass" id="grass22"></div>
          <div class="zomGrass" id="grass23"></div>
          <div class="zomGrass" id="grass24"></div>
          <div class="zomGrass" id="grass25"></div>
          <div class="zomGrass" id="grass26"></div>
          <div class="zomGrass" id="grass27"></div>
          <div class="zomGrass" id="grass28"></div>
          <div class="zomGrass" id="grass29"></div>
          <div class="zomGrass" id="grass30"></div>
          <div class="zomGrass" id="grass31"></div>
          <div class="zomGrass" id="grass32"></div>
          <div class="zomGrass" id="grass33"></div>
          <div class="zomGrass" id="grass34"></div>
          <div class="zomGrass" id="grass35"></div>
          <div class="zomGrass" id="grass36"></div>
          <div class="zomGrass" id="grass37"></div>
          <div class="zomGrass" id="grass38"></div>
          <div class="zomGrass" id="grass39"></div>
          <div class="zomGrass" id="grass40"></div>
          <div class="zomGrass" id="grass41"></div>
          <div class="zomGrass" id="grass42"></div>
          <div class="zomGrass" id="grass43"></div>
          <div class="zomGrass" id="grass44"></div>
          <div class="zomGrass" id="grass45"></div>
        </div>
      </div>
    </div>

    <script>
      let projectileIndex = 0;
      let positions = {
        grass1: { position: [1, 1], ocupation: "none" },
        grass2: { position: [1, 2], ocupation: "none" },
        grass3: { position: [1, 3], ocupation: "none" },
        grass4: { position: [1, 4], ocupation: "none" },
        grass5: { position: [1, 5], ocupation: "none" },
        grass6: { position: [1, 6], ocupation: "none" },
        grass7: { position: [1, 7], ocupation: "none" },
        grass8: { position: [1, 8], ocupation: "none" },
        grass9: { position: [1, 9], ocupation: "none" },
        grass10: { position: [2, 1], ocupation: "none" },
        grass11: { position: [2, 2], ocupation: "none" },
        grass12: { position: [2, 3], ocupation: "none" },
        grass13: { position: [2, 4], ocupation: "none" },
        grass14: { position: [2, 5], ocupation: "none" },
        grass15: { position: [2, 6], ocupation: "none" },
        grass16: { position: [2, 7], ocupation: "none" },
        grass17: { position: [2, 8], ocupation: "none" },
        grass18: { position: [2, 9], ocupation: "none" },
        grass19: { position: [3, 1], ocupation: "none" },
        grass20: { position: [3, 2], ocupation: "none" },
        grass21: { position: [3, 3], ocupation: "none" },
        grass22: { position: [3, 4], ocupation: "none" },
        grass23: { position: [3, 5], ocupation: "none" },
        grass24: { position: [3, 6], ocupation: "none" },
        grass25: { position: [3, 7], ocupation: "none" },
        grass26: { position: [3, 8], ocupation: "none" },
        grass27: { position: [3, 9], ocupation: "none" },
        grass28: { position: [4, 1], ocupation: "none" },
        grass29: { position: [4, 2], ocupation: "none" },
        grass30: { position: [4, 3], ocupation: "none" },
        grass31: { position: [4, 4], ocupation: "none" },
        grass32: { position: [4, 5], ocupation: "none" },
        grass33: { position: [4, 6], ocupation: "none" },
        grass34: { position: [4, 7], ocupation: "none" },
        grass35: { position: [4, 8], ocupation: "none" },
        grass36: { position: [4, 9], ocupation: "none" },
        grass37: { position: [5, 1], ocupation: "none" },
        grass38: { position: [5, 2], ocupation: "none" },
        grass39: { position: [5, 3], ocupation: "none" },
        grass40: { position: [5, 4], ocupation: "none" },
        grass41: { position: [5, 5], ocupation: "none" },
        grass42: { position: [5, 6], ocupation: "none" },
        grass43: { position: [5, 7], ocupation: "none" },
        grass44: { position: [5, 8], ocupation: "none" },
        grass45: { position: [5, 9], ocupation: "none" },
      };
      let income = 2;
      let money = 100;
      function addIncome() {
        money += Math.round(income / 10) + 1;

        updateMoney();
      }

      setInterval(addIncome, 500);

      function updateMoney() {
        let moneyDisplay = document.getElementById("moneyDisplay");
        moneyDisplay.innerHTML = money;
      }
      let flowerCounter = 0;
      let plantContainer = document.getElementById("plantContainer");
      let peashooters = {};

      let currentFlower = null; // Initialize currentFlower to null
      let currentSquare;
      let sunflowerMain = document.getElementById("sunflowerImg");
      let peashooterMain = document.getElementById("peashooterImg");
      let snowpeaMain = document.getElementById("snowpeaImg");
      squares = document.querySelectorAll(".zomGrass");

      sunflowerMain.addEventListener("click", (event) => {
        if (currentFlower !== null) {
          // Check if currentFlower is not null
          currentFlower.style.border = "0px solid black ";
        }

        currentFlower = sunflowerMain;
        currentFlower.style.border = "1px solid blue";
      });
      peashooterMain.addEventListener("click", (event) => {
        if (currentFlower !== null) {
          // Check if currentFlower is not null
          currentFlower.style.border = "0px solid black ";
        }
        currentFlower = peashooterMain;
        currentFlower.style.border = "1px solid blue ";
      });
      snowpeaMain.addEventListener("click", (event) => {
        if (currentFlower !== null) {
          // Check if currentFlower is not null
          currentFlower.style.border = "0px solid black ";
        }
        currentFlower = snowpeaMain;
        currentFlower.style.border = "1px solid blue ";
      });

      for (let x = 0; x < squares.length; x += 2) {
        squares[x].style.backgroundColor = "darkGreen";
      }
      squares.forEach((square) => {
        square.addEventListener("click", (event) => {
          currentSquare = square;

          if (currentFlower === peashooterMain && money >= 20) {
            money -= 20;
            updateMoney();

            new peashooter(currentSquare.id);
          }
          if (currentFlower === sunflowerMain && money >= 10) {
            money -= 10;
            income += 2;
            updateMoney();

            new sunflower(currentSquare.id);
          }
        });
      });

      originalSunflower = document.getElementById("sunflowerImg");

      class peashooter {
        constructor(squarePosition) {
          flowerCounter++;

          let id = "newPeashooter" + flowerCounter;

          plantContainer.innerHTML +=
            '<img style="" class="newPeashooter" id="newPeashooter' +
            flowerCounter +
            '" src="images/1769829-plant_peashooter_thumb.webp">';

          peashooters[id] = {};
          peashooters[id].position = squarePosition;

          squarePosition = positions[squarePosition].position;

          let leftValue = squarePosition[1] * 130 - 115;
          let topValue = squarePosition[0] * 130 - 110;
          let newPlant = document.getElementById(id);
          newPlant.style.position = "absolute";
          newPlant.style.left = leftValue + "px";
          newPlant.style.top = topValue + "px";

          // Immediately launch projectiles from the new peashooter
          let newProjectile = new Projectile(squarePosition);
          projectiles.push(newProjectile);
        }
      }

      class sunflower {
        constructor(squarePosition) {
          flowerCounter++;

          let id = "newSunflower" + flowerCounter;

          plantContainer.innerHTML +=
            '<img style="" class="newSunflower" id="newSunflower' +
            flowerCounter +
            '" src="images/Sunflower2009HD.webp">';

          squarePosition = positions[squarePosition].position;

          let leftValue = squarePosition[1] * 130 - 115;
          let topValue = squarePosition[0] * 130 - 110;
          let newPlant = document.getElementById(id);
          newPlant.style.position = "absolute";
          newPlant.style.left = leftValue + "px";
          newPlant.style.top = topValue + "px";
        }
      }
      let projectiles = [];

      function launchProjectiles() {
        for (let key in peashooters) {
          if (peashooters.hasOwnProperty(key)) {
            let newProjectile = new Projectile(peashooters[key].position);
            projectiles.push(newProjectile);
          }
        }
      }

      setInterval(launchProjectiles, 3000);

      class Projectile {
        constructor(startPosition, sourcePeashooterId) {
          this.sourcePeashooterId = sourcePeashooterId; // Save the source peashooter's ID
          console.log(
            "Creating new projectile from peashooter:",
            sourcePeashooterId
          );

          startPosition = positions[startPosition].position;

          let leftValue = startPosition[1] * 130 - 15;
          let topValue = startPosition[0] * 130 - 110;

          this.projectileIndex = projectileIndex++;
          this.element = document.createElement("div");
          this.element.className = "projectile";
          this.element.id = "projectile" + this.projectileIndex;
          this.element.style.left = leftValue + "px";
          this.element.style.top = topValue + "px";
          projectileContainer.appendChild(this.element);

          this.leftValue = leftValue;
          this.moveInterval = setInterval(() => this.move(), 30);
        }

        move() {
          this.leftValue += 10;
          this.element.style.left = this.leftValue + "px";

          // Check if the projectile has moved beyond the screen
          if (this.leftValue > 1170) {
            // Remove the projectile from the DOM
            this.element.remove();
            // Clear the moveInterval to stop further movement
            clearInterval(this.moveInterval);
          }
        }
      }
    </script>
  </body>
</html>
